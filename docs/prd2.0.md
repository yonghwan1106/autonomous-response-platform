# 자율주행 선발대 관제 플랫폼 PRD 2.0

## 📋 문서 개요
- **작성일**: 2025-10-31
- **버전**: 2.0
- **목적**: V1.0 프로토타입 완성 후 차기 버전 개선 사항 정의

---

## 🎯 V1.0 구현 현황

### ✅ 완성된 핵심 기능

#### 1. 재난 신고 및 AI 분석
- 자연어 재난 신고 접수
- Claude Sonnet 4 기반 신고 내용 구조화
- 주소 자동 추출 및 지오코딩 (Kakao Geocoding API)
- AI 상황 브리핑 자동 생성
- AI 작전 계획 자동 생성 (마크다운 형식)

#### 2. 자동 출동 시스템
- PostGIS 기반 최근접 소방서 탐색
- 모선/드론/로봇 자동 배정
- Kakao Directions API 기반 실제 도로 경로 계산
- 드론 직선 비행 경로 생성

#### 3. 실시간 관제 지도
- Kakao Maps SDK 통합
- 재난 발생지 마커 실시간 표시
- 선발대 유닛 마커 표시 (모선/드론/로봇)
- 유닛 이동 경로 폴리라인 시각화
- Supabase Realtime 구독으로 실시간 업데이트

#### 4. 센서 데이터 시뮬레이션
- 열화상 영상 모달 (드론 클릭)
- AI 객체 감지 시뮬레이션 (요구조자/화점)
- 온도 측정 및 신뢰도 표시

#### 5. 데이터베이스 구조
- PostgreSQL + PostGIS
- 테이블: disasters, response_units, sensor_data, hazard_overlays, ai_briefings
- RPC 함수: find_nearest_base, get_active_disasters, get_active_units

---

## 🚀 V2.0 개선 사항 (우선순위별)

### 🔴 MUST-HAVE (필수 구현)

#### 1. 실시간 유닛 이동 시뮬레이션
**현황**: 유닛이 고정된 위치에 표시됨
**개선**:
- 시간 경과에 따른 유닛 위치 자동 업데이트
- 경로를 따라 실제 이동하는 애니메이션
- 현장 도착 시간 추정 (ETA) 표시
- 이동 상태 변경 (deployed → en_route → arrived)

**기술 구현**:
```typescript
// Supabase Edge Function으로 주기적 위치 업데이트
setInterval(() => {
  updateUnitPosition(unitId, calculateNextPosition(route, currentIndex))
}, 5000) // 5초마다 업데이트
```

#### 2. 센서 데이터 실시간 수집 및 시각화
**현황**: 열화상 데이터만 시뮬레이션
**개선**:
- **열화상 센서**: 온도 히트맵, 요구조자 위치 자동 감지
- **LiDAR 센서**: 3D 공간 스캔 데이터, 건물 내부 구조 파악
- **가스 센서**: CO, CH4, H2S 농도 실시간 측정
- **연기 감지기**: 연기 농도 및 확산 방향

**UI 컴포넌트**:
- 센서 데이터 대시보드 (우측 패널)
- 실시간 그래프 (Chart.js/Recharts)
- 위험 수준에 따른 알림 시스템

#### 3. 다중 재난 동시 대응 관리
**현황**: 단일 재난 위주 UI
**개선**:
- 여러 재난을 탭/카드 형식으로 관리
- 우선순위 기반 재난 정렬 (severity 기준)
- 선발대 유닛 가용성 실시간 표시
- 유닛 재배정 기능 (한 재난에서 다른 재난으로)

#### 4. 관제사-현장 유닛 간 통신
**현황**: 통신 기능 없음
**개선**:
- 실시간 채팅 시스템 (Supabase Realtime Presence)
- 음성 메시지 전송/재생
- 긴급 알림 전송 (관제사 → 유닛)
- 상황 보고 (유닛 → 관제사)

**데이터베이스 스키마**:
```sql
CREATE TABLE messages (
  id UUID PRIMARY KEY,
  disaster_id UUID REFERENCES disasters(id),
  sender_type TEXT, -- 'control' or 'unit'
  sender_id TEXT,
  message TEXT,
  message_type TEXT, -- 'text', 'voice', 'alert'
  read BOOLEAN DEFAULT false,
  created_at TIMESTAMP
);
```

#### 5. 성능 최적화
**문제**: 마커 많아지면 지도 렌더링 느려짐
**개선**:
- 지도 클러스터링 (Kakao Maps Clusterer)
- 가상 스크롤링 (재난 목록)
- 이미지 최적화 (WebP, lazy loading)
- Debounce/Throttle (실시간 업데이트)

---

### 🟡 SHOULD-HAVE (권장 구현)

#### 6. 과거 재난 이력 및 분석 대시보드
- 재난 발생 통계 (일/주/월/년)
- 대응 시간 평균/최소/최대
- 히트맵 (재난 다발 지역)
- 구조 성공률 및 생존율 분석

**차트 종류**:
- 시계열 그래프 (재난 발생 추이)
- 파이 차트 (재난 유형별 비율)
- 지도 히트맵 (지역별 재난 빈도)

#### 7. 센서 데이터 기반 위험도 자동 분석
- 복합 센서 데이터 융합 (thermal + gas + smoke)
- AI 기반 위험도 점수 계산 (0-100)
- 자동 위험 구역 설정 (hazard_overlays)
- 대피 경로 추천

#### 8. 모바일 반응형 디자인
**현황**: 데스크톱 위주
**개선**:
- Tailwind breakpoints 활용
- 모바일에서 지도 크기 조정
- 햄버거 메뉴 (내비게이션)
- PWA 지원 (오프라인 캐싱)

#### 9. 구조대원용 모바일 앱 인터페이스
- 현장 도착 확인 버튼
- 실시간 센서 데이터 조회
- 작전 계획 확인
- 사진/동영상 업로드

#### 10. 외부 시스템 연동
- **C-ITS**: 긴급차량 우선 신호 제어 (시뮬레이션)
- **기상청 API**: 날씨 정보 (바람 방향, 강수량)
- **소방청 API**: 소방서 실시간 가용 인력
- **119 신고 시스템**: 실제 신고 데이터 연동 (Mock API)

---

### 🟢 NICE-TO-HAVE (선택 구현)

#### 11. 3D 건물 시각화
- Three.js 또는 Cesium.js
- 건물 내부 층별 구조 표시
- LiDAR 센서 데이터 3D 렌더링

#### 12. VR/AR 현장 시뮬레이션
- VR 헤드셋으로 현장 미리보기
- AR로 건물에 정보 오버레이

#### 13. 다국어 지원
- i18n (next-intl)
- 영어, 일본어, 중국어 지원
- 재난 신고 다국어 처리 (Claude 다국어 분석)

#### 14. 음성 명령 인터페이스
- Web Speech API
- "재난 신고 시작", "지도 확대" 등 음성 명령

#### 15. 머신러닝 기반 재난 예측
- 과거 데이터 기반 재난 발생 확률 예측
- 시간대/지역별 위험도 예측
- TensorFlow.js 활용

---

## 🛠 기술 스택 개선

### Frontend
| 현재 | 추가/변경 | 목적 |
|------|----------|------|
| Next.js 15, React 19 | 유지 | - |
| Tailwind CSS | 유지 | - |
| Kakao Maps SDK | 유지 | - |
| - | **Chart.js** / **Recharts** | 센서 데이터 그래프 |
| - | **Three.js** (선택) | 3D 시각화 |
| - | **React Query** | 서버 상태 관리 최적화 |
| - | **Zustand** | 클라이언트 전역 상태 |

### Backend
| 현재 | 추가/변경 | 목적 |
|------|----------|------|
| Next.js API Routes | 유지 | - |
| Supabase Realtime | 확장 | Presence, 채팅 |
| Claude Sonnet 4 | 유지 | - |
| - | **Supabase Edge Functions** | 주기적 유닛 위치 업데이트 |
| - | **Redis** (선택) | 실시간 데이터 캐싱 |

### Database
| 현재 | 추가 | 목적 |
|------|------|------|
| PostgreSQL + PostGIS | 유지 | - |
| RPC 함수 3개 | 추가 RPC | 복잡한 쿼리 최적화 |
| - | **TimescaleDB** (선택) | 센서 데이터 시계열 저장 |

### DevOps
- **Vercel**: 프로덕션 배포 (현재 사용 중)
- **GitHub Actions**: CI/CD 자동화
- **Sentry**: 에러 모니터링
- **Vercel Analytics**: 사용자 분석

---

## 🎨 UI/UX 개선

### 1. 레이아웃 개선
**현재**: 고정된 3열 그리드
**개선**:
- 드래그 가능한 패널 (react-grid-layout)
- 사용자 정의 레이아웃 저장
- 전체화면 모드 (지도/센서 데이터)

### 2. 다크 모드
- Tailwind dark: 클래스 활용
- 시스템 테마 자동 감지
- 토글 버튼 (헤더)

### 3. 알림 시스템
- Toast 알림 (react-hot-toast)
- 위험 수준별 색상 (info/warning/error)
- 사운드 알림 (긴급 상황)

### 4. 애니메이션
- Framer Motion
- 페이지 전환 애니메이션
- 유닛 이동 애니메이션
- 카드 hover 효과

### 5. 접근성 (a11y)
- ARIA 레이블
- 키보드 네비게이션
- 스크린 리더 지원
- 고대비 모드

---

## 🗺 로드맵

### 📅 3개월 (Q1 2026)
**목표**: 핵심 기능 완성도 향상

- [ ] 실시간 유닛 이동 시뮬레이션
- [ ] 센서 데이터 실시간 시각화 (thermal, gas)
- [ ] 다중 재난 관리 UI
- [ ] 관제사-유닛 채팅 기능
- [ ] 성능 최적화 (클러스터링)
- [ ] 과거 재난 통계 대시보드

**KPI**:
- 지도 렌더링 속도 < 2초
- 실시간 업데이트 지연 < 1초
- 동시 재난 처리 ≥ 10건

### 📅 6개월 (Q2 2026)
**목표**: 실무 활용 가능 수준

- [ ] 모바일 반응형 완성
- [ ] 구조대원용 모바일 앱 (PWA)
- [ ] 외부 시스템 연동 (C-ITS, 기상청)
- [ ] 센서 데이터 AI 분석
- [ ] LiDAR 3D 시각화
- [ ] 음성 메시지 기능

**KPI**:
- 모바일 접근성 ≥ 90점
- 외부 API 응답 시간 < 500ms
- AI 분석 정확도 ≥ 85%

### 📅 12개월 (2027)
**목표**: 실전 배치 및 확장

- [ ] 실제 119 시스템 연동 테스트
- [ ] VR/AR 시뮬레이션
- [ ] 다국어 지원 (3개 언어)
- [ ] 머신러닝 재난 예측
- [ ] 전국 소방서 데이터 확장
- [ ] 사용자 교육 프로그램

**KPI**:
- 실전 테스트 완료 ≥ 5회
- 전국 소방서 커버리지 ≥ 80%
- 사용자 만족도 ≥ 4.5/5.0

---

## 💡 추가 아이디어

### 1. 소방관 안전 모니터링
- 웨어러블 센서 (심박수, 체온, 위치)
- 위험 상황 자동 감지
- 백업 호출 자동화

### 2. 시민 참여형 재난 신고
- 시민이 촬영한 사진/동영상 업로드
- 크라우드소싱 재난 정보
- 검증 시스템 (AI + 관제사)

### 3. 재난 시뮬레이션 훈련 모드
- 가상 재난 시나리오 생성
- 구조대원 훈련용
- 성과 평가 및 피드백

### 4. 국제 표준 준수
- ISO 22320 (재난 관리)
- NFPA 1710 (소방 대응 표준)
- OpenAPI 제공 (타 시스템 연동)

### 5. 블록체인 기반 이력 관리
- 재난 대응 기록 불변성 보장
- 구조 활동 증명
- 투명한 성과 관리

---

## 📊 성공 지표 (KPI)

### 기술적 지표
- **응답 속도**: API 평균 응답 < 300ms
- **가용성**: 서비스 uptime ≥ 99.9%
- **동시 사용자**: ≥ 100명 처리
- **데이터 정확도**: 지오코딩 정확도 ≥ 95%

### 사용자 지표
- **신고 접수 시간**: < 30초
- **자동 출동 시간**: < 10초
- **AI 브리핑 생성**: < 5초
- **사용자 만족도**: ≥ 4.0/5.0

### 비즈니스 지표
- **골든타임 도달률**: 60% → 85%
- **구조 성공률**: 향상 추적
- **대응 시간 단축**: 20% 이상
- **구조대원 안전 사고**: 감소 추적

---

## 🔒 보안 및 개인정보

### 보안 강화
- HTTPS 필수
- API 키 환경변수 관리
- Supabase RLS 정책 강화
- CORS 설정 최적화
- Rate Limiting (API 남용 방지)

### 개인정보 보호
- 재난 신고자 정보 암호화
- 위치 정보 최소 수집
- GDPR/PIPA 준수
- 데이터 보관 기간 설정 (6개월)
- 익명화 처리 (통계 분석 시)

---

## 🤝 협업 및 오픈소스

### GitHub Repository
- Public repository 공개
- 기여 가이드라인 작성
- Issue 템플릿
- PR 리뷰 프로세스

### 문서화
- API 문서 (Swagger/OpenAPI)
- 사용자 매뉴얼
- 개발자 가이드
- 배포 가이드

### 커뮤니티
- Discord 서버 개설
- 정기 개발자 밋업
- 데모 영상 제작
- 블로그 포스팅

---

## 📝 결론

**V2.0의 핵심 가치**:
1. **실시간성**: 모든 데이터가 1초 이내 반영
2. **정확성**: AI 분석 정확도 85% 이상
3. **확장성**: 전국 규모 대응 가능
4. **실용성**: 실제 119 현장에서 사용 가능

**다음 단계**:
1. MUST-HAVE 항목부터 순차 개발
2. 매주 데모 및 피드백 수집
3. 소방청/지자체 협력 추진
4. 실전 테스트 준비

---

**작성자**: Claude Code Assistant
**최종 수정일**: 2025-10-31
**문서 버전**: 2.0
